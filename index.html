<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Lottery System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #000000 100%);
            color: #00ffff;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }
        
        body::before {
            display: none;
        }
        
        #container {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 30, 60, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 20px;
            border: 1px solid rgba(0, 255, 255, 0.4);
            box-shadow: 
                0 0 40px rgba(0, 255, 255, 0.4),
                0 0 80px rgba(0, 255, 255, 0.2),
                inset 0 2px 0 rgba(0, 255, 255, 0.15);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            min-width: 320px;
            max-width: 340px;
        }
        
        #titleRow {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            position: relative;
        }
        
        #settingsTitle {
            font-size: 1.2rem;
            font-weight: 700;
            color: #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.9), 
                         0 0 30px rgba(0, 255, 255, 0.5);
            font-family: 'SF Mono', 'Monaco', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding-bottom: 8px;
        }
        

        
        #settingsTitle::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        
        /* åº•éƒ¨æŒ‰é’®åŒºåŸŸ */
        #bottomButtons {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        #bottomButtons .button {
            width: 140px;
            height: 50px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 12px;
            letter-spacing: 1px;
            margin: 0;
            padding: 12px 20px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            #bottomButtons {
                bottom: 30px;
                flex-direction: column;
                gap: 15px;
            }
            
            #bottomButtons .button {
                width: 130px;
                height: 45px;
                font-size: 13px;
            }
            
            #controls {
                max-width: calc(100vw - 40px);
            }
            
            #controls.collapsed {
                min-width: 45px;
                max-width: 45px;
                width: 45px;
                height: 45px;
                padding: 8px;
            }
            
            #controls.collapsed #collapseLink {
                font-size: 18px;
                position: static;
                transform: none;
            }
        }
        
        @media (max-width: 480px) {
            #bottomButtons {
                bottom: 20px;
                gap: 10px;
            }
            
            #bottomButtons .button {
                width: 120px;
                height: 40px;
                font-size: 12px;
            }
            
            #controls.collapsed {
                min-width: 40px;
                max-width: 40px;
                width: 40px;
                height: 40px;
                padding: 6px;
            }
            
            #controls.collapsed #collapseLink {
                font-size: 16px;
                position: static;
                transform: none;
            }
        }
        
        #controls.collapsed {
            padding: 12px;
            min-width: 50px;
            max-width: 50px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        #controls.collapsed #inputSection,
        #controls.collapsed #loadNamesBtn,
        #controls.collapsed #buttonRow,
        #controls.collapsed #status {
            display: none;
        }
        
        #controls.collapsed #titleRow {
            margin: 0;
            justify-content: center;
        }
        
        #controls.collapsed #settingsTitle {
            display: none;
        }
        
        #controls.collapsed #collapseLink {
            color: #00ffff;
            font-size: 20px;
            text-align: center;
            width: 100%;
            text-decoration: none;
            position: static;
            transform: none;
        }
        
        #controls.collapsed #collapseLink:before {
            content: 'âš™ï¸';
            margin-right: 0;
        }
        
        #inputSection {
            opacity: 1;
            transform: translateY(0);
            max-height: 200px;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }
        

        

        
        /* æŒ‰é’®è¡Œå¸ƒå±€ */
        #buttonRow {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }
        
        /* ç®€åŒ–æŒ‰é’®æ ·å¼ */
        .simple-button {
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            text-align: center;
        }
        
        .simple-button:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .simple-button:active {
            transform: scale(0.98);
        }
        
        /* è½½å…¥åå•æŒ‰é’®å•ç‹¬ä¸€è¡Œ */
        #loadNamesBtn.simple-button {
            width: 100%;
            margin-top: 12px;
            border-color: rgba(76, 175, 80, 0.4);
            color: #4caf50;
        }
        
        #loadNamesBtn.simple-button:hover {
            border-color: rgba(76, 175, 80, 0.6);
            background: rgba(76, 175, 80, 0.08);
            color: #66bb6a;
        }
        
        /* å†å²è®°å½•å’Œè¯­è¨€æŒ‰é’®å¹¶æ’ */
        #buttonRow .simple-button {
            flex: 1;
        }
        
        #historyBtn.simple-button {
            border-color: rgba(186, 104, 200, 0.5);
            color: #ba68c8;
        }
        
        #historyBtn.simple-button:hover {
            border-color: rgba(186, 104, 200, 0.7);
            background: rgba(186, 104, 200, 0.12);
            color: #ce93d8;
        }
        
        #langBtn.simple-button {
            border-color: rgba(0, 255, 255, 0.4);
            color: #00ffff;
        }
        
        #langBtn.simple-button:hover {
            border-color: rgba(0, 255, 255, 0.6);
            background: rgba(0, 255, 255, 0.08);
            color: #4dd0e1;
        }


        
        /* Winner Modal - ä½¿ç”¨æ—¥æ–‡ç‰ˆçš„çˆ†ç‚¸æ•ˆæœ */
        #winner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            background: radial-gradient(circle, rgba(255, 107, 107, 0.9), rgba(255, 167, 38, 0.9), rgba(0, 0, 0, 0.9));
            display: none;
            animation: winnerExplode 3s ease-out;
            pointer-events: auto;
        }
        
        #winnerContent {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            pointer-events: auto;
            /* ç§»é™¤é‡å¤çš„ position: relative; */
            padding: 50px 30px 30px 30px; /* å¢åŠ é¡¶éƒ¨å†…è¾¹è·ä¸ºå…³é—­æŒ‰é’®ç•™å‡ºç©ºé—´ */
            min-width: 300px;
        }
        
        #closeBtn {
            position: absolute;
            top: 10px; /* è°ƒæ•´åˆ°å†…å®¹åŒºåŸŸå†…éƒ¨ */
            right: 10px; /* è°ƒæ•´åˆ°å†…å®¹åŒºåŸŸå†…éƒ¨ */
            background: rgba(255, 50, 50, 0.9);
            border: 2px solid rgba(255, 100, 100, 0.8);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1002;
            user-select: none;
            pointer-events: auto;
            outline: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        #closeBtn:hover {
            background: rgba(255, 80, 80, 1);
            border-color: rgba(255, 120, 120, 1);
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(255, 50, 50, 0.5);
        }
        
        #closeBtn:active {
            transform: scale(1.05);
            background: rgba(255, 30, 30, 1);
        }
        
        #closeBtn:focus {
            outline: 2px solid rgba(255, 255, 255, 0.5);
            outline-offset: 2px;
        }
        
        /* å“åº”å¼è®¾è®¡è°ƒæ•´ */
        @media (max-width: 768px) {
            #closeBtn {
                top: 8px;
                right: 8px;
                width: 35px;
                height: 35px;
                font-size: 18px;
            }
        }
        
        @media (max-width: 480px) {
            #closeBtn {
                top: 6px;
                right: 6px;
                width: 32px;
                height: 32px;
                font-size: 16px;
            }
        }
        
        #winnerText {
            font-size: 4rem;
            font-weight: bold;
            text-shadow: 0 0 30px #fff, 0 0 60px #ff6b6b;
            margin-bottom: 20px;
            animation: winnerPulse 1s infinite;
            font-family: 'SF Mono', 'Monaco', monospace;
        }
        
        #prizeText {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 15px;
            color: #ffa726;
            text-shadow: 0 0 15px currentColor;
            font-family: 'SF Mono', 'Monaco', monospace;
        }
        
        #winnerName {
            font-size: 6rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #ffa726, #4ecdc4, #45b7d1);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbowText 2s infinite, winnerBounce 0.6s infinite;
            text-shadow: 0 0 50px rgba(255, 255, 255, 0.8);
            font-family: 'SF Mono', 'Monaco', monospace;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        /* æ—¥æ–‡ç‰ˆçš„åŠ¨ç”»å…³é”®å¸§ */
        @keyframes winnerExplode {
            0% { 
                opacity: 0;
                transform: scale(0);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes winnerBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        @keyframes winnerPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        @keyframes rainbowText {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* ç®€åŒ–çƒŸèŠ±æ ·å¼ */
        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            pointer-events: none;
            z-index: 1500;
        }
        
        .confetti-piece {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 2px;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        

        
        #nameInput {
            width: 100%;
            height: 100px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: white;
            padding: 12px;
            font-size: 13px;
            font-family: inherit;
            resize: none;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        #nameInput {
            width: 100%;
            height: 80px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: white;
            padding: 12px;
            font-size: 13px;
            font-family: inherit;
            resize: none;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        #prizeInput {
            width: 100%;
            height: 40px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: white;
            padding: 12px;
            font-size: 13px;
            font-family: inherit;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        #nameInput:focus, #prizeInput:focus {
            outline: none;
            border: 1px solid rgba(100, 181, 246, 0.5);
            box-shadow: 0 0 15px rgba(100, 181, 246, 0.2);
        }
        
        #nameInput::placeholder, #prizeInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .button {
            width: 100%;
            padding: 12px;
            background: rgba(255, 107, 107, 0.15);
            border: 2px solid #ff6b6b;
            border-radius: 12px;
            color: #ff6b6b;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 6px 0;
            position: relative;
            overflow: hidden;
            font-family: inherit;
            box-shadow: 
                0 0 10px rgba(255, 107, 107, 0.5),
                0 0 20px rgba(255, 107, 107, 0.3),
                0 0 30px rgba(255, 107, 107, 0.2),
                inset 0 0 10px rgba(255, 107, 107, 0.1);
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.8);
        }
        
        .button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg) translateX(-100%);
            transition: transform 0.6s;
        }
        
        .button:hover::before {
            transform: rotate(45deg) translateX(100%);
        }
        
        .button:hover {
            transform: translateY(-2px);
            background: rgba(255, 107, 107, 0.25);
            border-color: #ff8e8e;
            color: #fff;
            box-shadow: 
                0 0 20px rgba(255, 107, 107, 0.8),
                0 0 30px rgba(255, 107, 107, 0.6),
                0 0 40px rgba(255, 107, 107, 0.4),
                inset 0 0 20px rgba(255, 107, 107, 0.2);
            text-shadow: 0 0 20px rgba(255, 107, 107, 1);
        }
        
        .button:active {
            transform: scale(0.98);
        }
        
        @keyframes neonPulse {
            0% {
                box-shadow: 
                    0 0 5px rgba(255, 107, 107, 0.4),
                    0 0 10px rgba(255, 107, 107, 0.2),
                    0 0 15px rgba(255, 107, 107, 0.1),
                    inset 0 0 5px rgba(255, 107, 107, 0.1);
                text-shadow: 0 0 5px rgba(255, 107, 107, 0.6);
            }
            100% {
                box-shadow: 
                    0 0 15px rgba(255, 107, 107, 0.6),
                    0 0 25px rgba(255, 107, 107, 0.4),
                    0 0 35px rgba(255, 107, 107, 0.3),
                    inset 0 0 15px rgba(255, 107, 107, 0.2);
                text-shadow: 0 0 15px rgba(255, 107, 107, 0.9);
            }
        }
        
        @keyframes neonPulseHover {
            0% {
                box-shadow: 
                    0 0 15px rgba(255, 107, 107, 0.6),
                    0 0 25px rgba(255, 107, 107, 0.4),
                    0 0 35px rgba(255, 107, 107, 0.3),
                    inset 0 0 15px rgba(255, 107, 107, 0.2);
            }
            100% {
                box-shadow: 
                    0 0 25px rgba(255, 107, 107, 0.9),
                    0 0 35px rgba(255, 107, 107, 0.7),
                    0 0 45px rgba(255, 107, 107, 0.5),
                    inset 0 0 25px rgba(255, 107, 107, 0.3);
            }
        }
        

        
        #startBtn {
            background: rgba(0, 255, 127, 0.2);
            border-color: #00ff7f;
            color: #00ff7f;
            box-shadow: 
                0 0 15px rgba(0, 255, 127, 0.6),
                0 0 30px rgba(0, 255, 127, 0.4),
                0 0 45px rgba(0, 255, 127, 0.2),
                inset 0 0 15px rgba(0, 255, 127, 0.15);
            text-shadow: 0 0 15px rgba(0, 255, 127, 0.9);
        }
        
        #startBtn::before {
            content: 'ğŸš€';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            animation: rocket 2s ease-in-out infinite;
        }
        
        @keyframes rocket {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.2) rotate(15deg); }
        }
        
        @keyframes neonPulseStart {
            0% {
                box-shadow: 
                    0 0 10px rgba(0, 255, 127, 0.4),
                    0 0 20px rgba(0, 255, 127, 0.2),
                    0 0 30px rgba(0, 255, 127, 0.1),
                    inset 0 0 10px rgba(0, 255, 127, 0.1);
                text-shadow: 0 0 10px rgba(0, 255, 127, 0.7);
            }
            100% {
                box-shadow: 
                    0 0 20px rgba(0, 255, 127, 0.7),
                    0 0 40px rgba(0, 255, 127, 0.5),
                    0 0 60px rgba(0, 255, 127, 0.3),
                    inset 0 0 20px rgba(0, 255, 127, 0.2);
                text-shadow: 0 0 20px rgba(0, 255, 127, 1);
            }
        }
        
        #startBtn:hover {
            background: rgba(0, 255, 127, 0.3);
            border-color: #32ff9a;
            color: #fff;
            box-shadow: 
                0 0 25px rgba(0, 255, 127, 0.9),
                0 0 50px rgba(0, 255, 127, 0.7),
                0 0 75px rgba(0, 255, 127, 0.5),
                inset 0 0 25px rgba(0, 255, 127, 0.3);
            text-shadow: 0 0 25px rgba(0, 255, 127, 1);
        }
        
        @keyframes neonPulseStartHover {
            0% {
                box-shadow: 
                    0 0 20px rgba(0, 255, 127, 0.7),
                    0 0 40px rgba(0, 255, 127, 0.5),
                    0 0 60px rgba(0, 255, 127, 0.3),
                    inset 0 0 20px rgba(0, 255, 127, 0.2);
            }
            100% {
                box-shadow: 
                    0 0 35px rgba(0, 255, 127, 1),
                    0 0 70px rgba(0, 255, 127, 0.8),
                    0 0 105px rgba(0, 255, 127, 0.6),
                    inset 0 0 35px rgba(0, 255, 127, 0.4);
            }
        }
        
        @keyframes neonPulseBlue {
            0% {
                box-shadow: 
                    0 0 5px rgba(33, 150, 243, 0.4),
                    0 0 10px rgba(33, 150, 243, 0.2),
                    0 0 15px rgba(33, 150, 243, 0.1),
                    inset 0 0 5px rgba(33, 150, 243, 0.1);
                text-shadow: 0 0 5px rgba(33, 150, 243, 0.6);
            }
            100% {
                box-shadow: 
                    0 0 15px rgba(33, 150, 243, 0.6),
                    0 0 25px rgba(33, 150, 243, 0.4),
                    0 0 35px rgba(33, 150, 243, 0.3),
                    inset 0 0 15px rgba(33, 150, 243, 0.2);
                text-shadow: 0 0 15px rgba(33, 150, 243, 0.9);
            }
        }
        
        @keyframes neonPulseBlueHover {
            0% {
                box-shadow: 
                    0 0 15px rgba(33, 150, 243, 0.6),
                    0 0 25px rgba(33, 150, 243, 0.4),
                    0 0 35px rgba(33, 150, 243, 0.3),
                    inset 0 0 15px rgba(33, 150, 243, 0.2);
            }
            100% {
                box-shadow: 
                    0 0 25px rgba(33, 150, 243, 0.9),
                    0 0 35px rgba(33, 150, 243, 0.7),
                    0 0 45px rgba(33, 150, 243, 0.5),
                    inset 0 0 25px rgba(33, 150, 243, 0.3);
            }
        }
        
        #stopBtn {
            background: rgba(255, 69, 0, 0.2);
            border-color: #ff4500;
            color: #ff4500;
            box-shadow: 
                0 0 15px rgba(255, 69, 0, 0.6),
                0 0 30px rgba(255, 69, 0, 0.4),
                0 0 45px rgba(255, 69, 0, 0.2),
                inset 0 0 15px rgba(255, 69, 0, 0.15);
            text-shadow: 0 0 15px rgba(255, 69, 0, 0.9);
        }
        
        #stopBtn::before {
            content: 'â¹ï¸';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            animation: stopPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes stopPulse {
            0%, 100% { 
                transform: translateY(-50%) scale(1); 
                filter: brightness(1);
            }
            50% { 
                transform: translateY(-50%) scale(1.15); 
                filter: brightness(1.3);
            }
        }
        
        @keyframes neonPulseStop {
            0% {
                box-shadow: 
                    0 0 10px rgba(255, 69, 0, 0.4),
                    0 0 20px rgba(255, 69, 0, 0.2),
                    0 0 30px rgba(255, 69, 0, 0.1),
                    inset 0 0 10px rgba(255, 69, 0, 0.1);
                text-shadow: 0 0 10px rgba(255, 69, 0, 0.7);
            }
            100% {
                box-shadow: 
                    0 0 20px rgba(255, 69, 0, 0.7),
                    0 0 40px rgba(255, 69, 0, 0.5),
                    0 0 60px rgba(255, 69, 0, 0.3),
                    inset 0 0 20px rgba(255, 69, 0, 0.2);
                text-shadow: 0 0 20px rgba(255, 69, 0, 1);
            }
        }
        
        #stopBtn:hover {
            background: rgba(255, 69, 0, 0.35);
            border-color: #ff6347;
            color: #fff;
            box-shadow: 
                0 0 25px rgba(255, 69, 0, 0.9),
                0 0 50px rgba(255, 69, 0, 0.7),
                0 0 75px rgba(255, 69, 0, 0.5),
                inset 0 0 25px rgba(255, 69, 0, 0.3);
            text-shadow: 0 0 25px rgba(255, 69, 0, 1);
        }
        
        @keyframes neonPulseStopHover {
            0% {
                box-shadow: 
                    0 0 20px rgba(255, 69, 0, 0.7),
                    0 0 40px rgba(255, 69, 0, 0.5),
                    0 0 60px rgba(255, 69, 0, 0.3),
                    inset 0 0 20px rgba(255, 69, 0, 0.2);
            }
            100% {
                box-shadow: 
                    0 0 35px rgba(255, 69, 0, 1),
                    0 0 70px rgba(255, 69, 0, 0.8),
                    0 0 105px rgba(255, 69, 0, 0.6),
                    inset 0 0 35px rgba(255, 69, 0, 0.4);
            }
        }
        
        .button:disabled {
            background: rgba(102, 102, 102, 0.15);
            border-color: #666;
            color: #666;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 
                0 0 5px rgba(102, 102, 102, 0.3),
                inset 0 0 5px rgba(102, 102, 102, 0.1);
            text-shadow: none;
        }
        
        .button:disabled::before {
            display: none;
        }
        
        .button:disabled:hover {
            background: rgba(102, 102, 102, 0.15);
            border-color: #666;
            color: #666;
            box-shadow: 
                0 0 5px rgba(102, 102, 102, 0.3),
                inset 0 0 5px rgba(102, 102, 102, 0.1);
            text-shadow: none;
        }
        
        #collapseLink {
            color: #00ffff;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.8);
            transition: all 0.3s ease;
            font-family: 'SF Mono', 'Monaco', monospace;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            /* ç§»é™¤ç»å¯¹å®šä½ï¼Œè®©å®ƒè‡ªç„¶æ’åˆ—åœ¨æ ‡é¢˜æ—è¾¹ */
            margin-left: 15px; /* æ·»åŠ å·¦è¾¹è·ä¸æ ‡é¢˜ä¿æŒé€‚å½“é—´è· */
            /* ç§»é™¤ä»¥ä¸‹è¡Œï¼š
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            */
        }
        
        #collapseLink:hover {
            color: #fff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 1);
        }
        
        #status {
            text-align: center;
            font-size: 12px;
            opacity: 0.6;
            font-weight: 400;
            margin: 68px 0 0 0;
            padding: 0;
            background: none;
            border: none;
        }
        
        /* History Modal */
        #historyModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8); /* ç®€åŒ–ä¸ºçº¯é»‘è‰²é€æ˜åº¦ */
            /* ç§»é™¤: backdrop-filter: blur(20px); */
            /* ç§»é™¤: -webkit-backdrop-filter: blur(20px); */
            z-index: 1001;
            display: none;
            align-items: center;
            justify-content: center;
            /* ç§»é™¤: animation: fadeIn 0.5s ease; */
        }
        
        /* ç®€åŒ–å†å²è®°å½•å†…å®¹å®¹å™¨ */
        #historyContent {
            background: rgba(20, 20, 30, 0.95); /* ç®€åŒ–ä¸ºçº¯è‰²èƒŒæ™¯ */
            /* ç§»é™¤å¤æ‚æ¸å˜: linear-gradient(135deg, rgba(0, 15, 30, 0.95) 0%, rgba(10, 25, 45, 0.9) 100%); */
            border: 1px solid rgba(0, 255, 255, 0.3); /* ç®€åŒ–è¾¹æ¡† */
            border-radius: 8px; /* å‡å°åœ†è§’ */
            padding: 20px; /* å‡å°‘å†…è¾¹è· */
            max-width: 85%;
            max-height: 75%;
            overflow-y: auto;
            /* ç§»é™¤å¤æ‚é˜´å½±: box-shadow: 0 0 40px rgba(0, 255, 255, 0.2), inset 0 1px 0 rgba(0, 255, 255, 0.1); */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); /* ç®€åŒ–é˜´å½± */
            position: relative;
            min-width: 320px;
        }
        
        /* ç®€åŒ–å†å²è®°å½•æ ‡é¢˜ */
        #historyTitle {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: #00ffff;
            /* ç§»é™¤: text-shadow: 0 0 10px currentColor; */
            font-family: 'SF Mono', 'Monaco', monospace;
            /* ç§»é™¤: text-transform: uppercase; */
            /* ç§»é™¤: letter-spacing: 2px; */
        }
        
        /* ç®€åŒ–å†å²è®°å½•é¡¹ç›® */
        .history-item {
            background: rgba(30, 30, 40, 0.8); /* ç®€åŒ–èƒŒæ™¯ */
            /* ç§»é™¤å¤æ‚æ¸å˜: linear-gradient(135deg, rgba(0, 20, 40, 0.7) 0%, rgba(0, 30, 60, 0.6) 100%); */
            border: 1px solid rgba(255, 255, 255, 0.1); /* ç®€åŒ–è¾¹æ¡† */
            border-radius: 4px; /* å‡å°åœ†è§’ */
            padding: 10px; /* å‡å°‘å†…è¾¹è· */
            margin-bottom: 6px; /* å‡å°‘é—´è· */
            /* ç§»é™¤è¿‡æ¸¡åŠ¨ç”»: transition: all 0.3s ease; */
        }
        
        .history-item:hover {
            background: rgba(40, 40, 50, 0.9); /* ç®€åŒ–æ‚¬åœæ•ˆæœ */
            /* ç§»é™¤: border: 1px solid rgba(0, 255, 255, 0.4); */
            /* ç§»é™¤: box-shadow: 0 0 15px rgba(0, 255, 255, 0.1); */
            /* ç§»é™¤: transform: translateY(-1px); */
        }
        
        /* ç®€åŒ–æ—¶é—´æ˜¾ç¤º */
        .history-time {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6); /* ç®€åŒ–é¢œè‰² */
            margin-bottom: 3px;
            font-family: 'SF Mono', 'Monaco', monospace;
            /* ç§»é™¤: text-transform: uppercase; */
            /* ç§»é™¤: letter-spacing: 0.5px; */
        }
        
        /* ç®€åŒ–è·å¥–è€…æ˜¾ç¤º */
        .history-winner {
            font-size: 1rem;
            font-weight: 600;
            color: #00ff88; /* ç®€åŒ–é¢œè‰² */
            /* ç§»é™¤: text-shadow: 0 0 5px currentColor; */
            font-family: 'SF Mono', 'Monaco', monospace;
        }
        
        /* ç®€åŒ–å¥–å“æ˜¾ç¤º */
        .history-prize {
            font-size: 0.85rem;
            color: rgba(255, 255, 100, 0.9); /* ç®€åŒ–é¢œè‰² */
            margin-top: 2px;
            font-family: 'SF Mono', 'Monaco', monospace;
        }
        
        /* ç®€åŒ–æ¸…é™¤å†å²æŒ‰é’® */
        #clearHistoryBtn {
            background: rgba(180, 50, 50, 0.8); /* ç®€åŒ–èƒŒæ™¯ */
            /* ç§»é™¤å¤æ‚æ¸å˜: linear-gradient(135deg, rgba(100, 0, 0, 0.8) 0%, rgba(150, 0, 0, 0.7) 100%); */
            border: 1px solid rgba(255, 100, 100, 0.6);
            color: #ff8888;
            padding: 8px 16px;
            border-radius: 4px; /* å‡å°åœ†è§’ */
            font-size: 11px;
            cursor: pointer;
            /* ç§»é™¤è¿‡æ¸¡åŠ¨ç”»: transition: all 0.3s ease; */
            margin-top: 10px;
            width: 100%;
            font-family: 'SF Mono', 'Monaco', monospace;
            /* ç§»é™¤: text-transform: uppercase; */
            /* ç§»é™¤: letter-spacing: 0.5px; */
            /* ç§»é™¤: text-shadow: 0 0 5px currentColor; */
        }
        
        #clearHistoryBtn:hover {
            background: rgba(200, 60, 60, 0.9); /* ç®€åŒ–æ‚¬åœæ•ˆæœ */
            /* ç§»é™¤: border: 1px solid rgba(255, 100, 100, 0.8); */
            /* ç§»é™¤: box-shadow: 0 0 15px rgba(255, 100, 100, 0.3); */
        }
        
        /* ç®€åŒ–å…³é—­æŒ‰é’® */
        #closeHistoryBtn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(100, 100, 100, 0.8); /* ç®€åŒ–èƒŒæ™¯ */
            /* ç§»é™¤å¤æ‚æ¸å˜: linear-gradient(135deg, rgba(100, 0, 0, 0.8) 0%, rgba(150, 0, 0, 0.7) 100%); */
            border: 1px solid rgba(200, 200, 200, 0.6);
            color: #ffffff;
            width: 30px;
            height: 30px;
            border-radius: 4px; /* å‡å°åœ†è§’ */
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            /* ç§»é™¤: text-shadow: 0 0 5px currentColor; */
        }
        
        #closeHistoryBtn:hover {
            background: rgba(120, 120, 120, 0.9); /* ç®€åŒ–æ‚¬åœæ•ˆæœ */
            /* ç§»é™¤: background: linear-gradient(135deg, rgba(150, 0, 0, 0.9) 0%, rgba(200, 0, 0, 0.8) 100%); */
            /* ç§»é™¤: box-shadow: 0 0 15px rgba(255, 100, 100, 0.4); */
            /* ç§»é™¤: transform: scale(1.1); */
        }
        
        /* ç§»é™¤fadeInåŠ¨ç”» */
        /*
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        */
        
        /* ç§»é™¤é‡å¤çš„History Modalæ ·å¼ */
        /*
        #historyModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(26, 35, 126, 0.3);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            z-index: 1001;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }
        
        #historyContent {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(35px);
            -webkit-backdrop-filter: blur(35px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 25px;
            padding: 30px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            position: relative;
            min-width: 400px;
        }
        */

        /* æ·»åŠ åº•éƒ¨ç½²åæ ·å¼ */
        #footer {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
        }

        #footerText {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-family: 'SF Mono', 'Monaco', monospace;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #footerText:hover {
            color: rgba(0, 255, 255, 0.9);
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.2);
        }

        /* å¿ƒå½¢emojiç‰¹æ®Šæ•ˆæœ */
        #footerText:hover::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: #ff69b4;
            border-radius: 50%;
            box-shadow: 0 0 10px #ff69b4;
            animation: heartbeat 1.5s infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.2); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            #footer {
                bottom: 10px;
            }
            
            #footerText {
                font-size: 11px;
                padding: 4px 8px;
            }
            
            #bottomButtons {
                bottom: 40px; /* ä¸ºåº•éƒ¨ç½²åç•™å‡ºç©ºé—´ */
            }
        }

        @media (max-width: 480px) {
            #footer {
                bottom: 8px;
            }
            
            #footerText {
                font-size: 10px;
                padding: 3px 6px;
            }
            
            #bottomButtons {
                bottom: 35px; /* ä¸ºåº•éƒ¨ç½²åç•™å‡ºç©ºé—´ */
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="controls">
            <div id="titleRow">
                <div id="settingsTitle" data-key="settingsTitle">æŠ½çè¨­å®š</div>
                <span id="collapseLink" data-key="collapseLink">æ”¶èµ·</span>
            </div>
            <div id="inputSection">
                <textarea id="nameInput" data-key="nameInput" placeholder="è«‹è¼¸å…¥åƒèˆ‡è€…åå–®ï¼Œæ¯è¡Œä¸€å€‹åå­—ï¼š&#10;å¼µä¸‰&#10;æå››&#10;ç‹äº”&#10;..."></textarea>
                                <input type="text" id="prizeInput" data-key="prizeInput" placeholder="è«‹è¼¸å…¥ç¦®ç‰©åç¨±ï¼ˆä¾‹å¦‚ï¼šiPhone 15 Proï¼‰">
                <button id="loadNamesBtn" class="simple-button" data-key="loadNamesBtn">è¼‰å…¥åå–®</button>
                <div id="buttonRow">
                    <button id="historyBtn" class="simple-button" data-key="historyBtn">æ­·å²è¨˜éŒ„</button>
                    <button id="langBtn" class="simple-button" data-key="langBtn">ä¸­æ–‡</button>
                </div>
            </div>
            

            <div id="status" data-key="status">è«‹å…ˆè¼‰å…¥åå–®</div>
        </div>
        
        <!-- åº•éƒ¨æŒ‰é’®åŒºåŸŸ -->
        <div id="bottomButtons">
            <button id="startBtn" class="button" disabled data-key="startBtn">é–‹å§‹æŠ½ç</button>
            <button id="stopBtn" class="button" disabled data-key="stopBtn">åœæ­¢</button>
        </div>
        
        <!-- æ·»åŠ åº•éƒ¨ç½²å -->
        <div id="footer">
            <a href="mailto:hihi.todd@gmail.com" id="footerText" data-key="footerText">ç”¨â¤ï¸è¨­è¨ˆ by hihi.todd@gmail.com</a>
        </div>
        

        
        <div id="winner">
            <div id="winnerContent">
                <button id="closeBtn">Ã—</button>
                <div id="winnerText" data-key="winnerText">æ­å–œä¸­ç</div>
                <div id="prizeText"></div>
                <div id="winnerName"></div>
            </div>
        </div>
        
        <div id="historyModal">
            <div id="historyContent">
                <button id="closeHistoryBtn" style="position: absolute; top: 15px; right: 20px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: bold; display: flex; align-items: center; justify-content: center;">Ã—</button>
                <div id="historyTitle" data-key="historyTitle">æŠ½çæ­·å²</div>
                <div id="historyList"></div>
                <button id="clearHistoryBtn" data-key="clearHistoryBtn">æ¸…é™¤æ­·å²è¨˜éŒ„</button>
            </div>
        </div>
        

    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let scene, camera, renderer, sphere, particles, names = [];
        let isSpinning = false, isSlowingDown = false;
        let rotationSpeed = 0, targetSpeed = 0;
        let nameObjects = [];
        let particleSystem;
        let currentPrize = "";
        let winHistory = [];
        let currentLang = 'zh';
        
        // å¤šèªè¨€é…ç½®
        const translations = {
            en: {
                nameInput: "Enter participant names, one per line:\nJohn\nJane\nBob\n...",
                prizeInput: "Enter prize name (e.g., iPhone 15 Pro)",
                loadNamesBtn: "Load Names",
                startBtn: "Start",
                stopBtn: "Stop",
                historyBtn: "History",
                status: "Please load names first",
                winnerText: "Congratulations",
                historyTitle: "Lottery History",
                clearHistoryBtn: "Clear History",
                loadedStatus: "participants loaded | Prize:",
                winnerStatus: "Winner:",
                received: "Received:",
                drawing: "Drawing...",
                slowing: "Slowing down...",
                prizeLabel: "Prize:",
                defaultPrize: "Mystery Prize",
                alertLoadNames: "Please enter participant names!",
                alertValidNames: "Please enter valid names!",
                confirmClear: "Clear all history records?",
                settingsTitle: "Settings",
                collapseLink: "Collapse",
                langBtn: "English",
                footerText: "Designed with â¤ï¸ by hihi.todd@gmail.com" // æ–°å¢è‹±æ–‡ç½²å
            },
            zh: {
                nameInput: "è«‹è¼¸å…¥åƒèˆ‡è€…åå–®ï¼Œæ¯è¡Œä¸€å€‹åå­—ï¼š\nå¼µä¸‰\næå››\nç‹äº”\n...",
                prizeInput: "è«‹è¼¸å…¥ç¦®ç‰©åç¨±ï¼ˆä¾‹å¦‚ï¼šiPhone 15 Proï¼‰",
                loadNamesBtn: "è¼‰å…¥åå–®",
                startBtn: "é–‹å§‹æŠ½ç",
                stopBtn: "åœæ­¢",
                historyBtn: "æ­·å²è¨˜éŒ„",
                status: "è«‹å…ˆè¼‰å…¥åå–®",
                winnerText: "æ­å–œä¸­ç",
                historyTitle: "æŠ½çæ­·å²",
                clearHistoryBtn: "æ¸…é™¤æ­·å²è¨˜éŒ„",
                loadedStatus: "å€‹åƒèˆ‡è€… | çå“:",
                winnerStatus: "ç²çè€…:",
                received: "ç²å¾—:",
                drawing: "æŠ½çé€²è¡Œä¸­...",
                slowing: "æ¸›é€Ÿä¸­...",
                prizeLabel: "çå“ï¼š",
                defaultPrize: "ç¥ç§˜å¤§ç",
                alertLoadNames: "è«‹è¼¸å…¥åå–®ï¼",
                alertValidNames: "è«‹è¼¸å…¥æœ‰æ•ˆçš„åå–®ï¼",
                confirmClear: "ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²è¨˜éŒ„å—ï¼Ÿ",
                settingsTitle: "æŠ½çè¨­å®š",
                collapseLink: "æ”¶èµ·",
                langBtn: "ä¸­æ–‡",
                footerText: "ç”¨â¤ï¸è¨­è¨ˆ by hihi.todd@gmail.com" // æ–°å¢ä¸­æ–‡ç½²å
            },
            ja: {
                nameInput: "å‚åŠ è€…åç°¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ1è¡Œã«1åï¼‰:\nå¤ªéƒ\nèŠ±å­\næ¬¡éƒ\n...",
                prizeInput: "è³å“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šiPhone 15 Proï¼‰",
                loadNamesBtn: "åç°¿èª­ã¿è¾¼ã¿",
                startBtn: "æŠ½é¸é–‹å§‹",
                stopBtn: "åœæ­¢",
                historyBtn: "å±¥æ­´",
                status: "åç°¿ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„",
                winnerText: "å½“é¸ãŠã‚ã§ã¨ã†",
                historyTitle: "æŠ½é¸å±¥æ­´",
                clearHistoryBtn: "å±¥æ­´ã‚’ã‚¯ãƒªã‚¢",
                loadedStatus: "åã®å‚åŠ è€… | è³å“:",
                winnerStatus: "å½“é¸è€…:",
                received: "ç²å¾—:",
                drawing: "æŠ½é¸ä¸­...",
                slowing: "æ¸›é€Ÿä¸­...",
                prizeLabel: "è³å“ï¼š",
                defaultPrize: "ãƒŸã‚¹ãƒ†ãƒªãƒ¼è³å“",
                alertLoadNames: "å‚åŠ è€…åç°¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼",
                alertValidNames: "æœ‰åŠ¹ãªåç°¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼",
                confirmClear: "ã™ã¹ã¦ã®å±¥æ­´è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ",
                settingsTitle: "æŠ½é¸è¨­å®š",
                collapseLink: "æŠ˜ã‚ŠãŸãŸã‚€",
                langBtn: "æ—¥æœ¬èª",
                footerText: "â¤ï¸ã§ãƒ‡ã‚¶ã‚¤ãƒ³ by hihi.todd@gmail.com" // æ–°å¢æ—¥æ–‡ç½²å
            }
        };
        
        function createCheerSound() {
            // å‰µé€ æ­¡å‘¼è²æ•ˆæœ
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createTone(300 + Math.random() * 200, 0.3, 'sawtooth');
                }, i * 100);
            }
            
            // é™„åŠ æ…¶ç¥éŸ³æ•ˆ
            setTimeout(() => {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        createTone(800 + Math.random() * 400, 0.2, 'square');
                    }, i * 150);
                }
            }, 500);
        }
        
        function createConfetti() {
            const colors = [
                '#ff4444', '#00ffcc', '#ffaa00', '#bb66ff', 
                '#44ff44', '#ff44bb', '#4444ff', '#ffff44',
                '#ff8844', '#44ffff', '#cc44ff', '#88ff44'
            ];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animation = `confetti-fall ${2 + Math.random() * 3}s linear`;
                    confetti.style.boxShadow = `0 0 10px ${confetti.style.background}`;
                    
                    document.body.appendChild(confetti);
                    
                    confetti.addEventListener('animationend', () => {
                        confetti.remove();
                    });
                }, i * 30);
            }
        }
        
        function updateLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            // æ›´æ–°æ‰€æœ‰å¸¶æœ‰ data-key çš„å…ƒç´ 
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (t[key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = t[key];
                    } else {
                        el.textContent = t[key];
                    }
                }
            });
            
            // é‡æ–°æ¸²æŸ“æ­·å²è¨˜éŒ„
            renderHistory();
        }
        
        function switchLanguage() {
            const languages = ['zh', 'en', 'ja'];
            const currentIndex = languages.indexOf(currentLang);
            const nextIndex = (currentIndex + 1) % languages.length;
            updateLanguage(languages[nextIndex]);
        }
        
        // éŸ³æ•ˆç³»çµ±
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function createTone(frequency, duration, type = 'sine') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playSpinSound() {
            if (isSpinning) {
                createTone(200 + Math.random() * 100, 0.1, 'square');
                setTimeout(playSpinSound, 100);
            }
        }
        
        // æ›¿æ¢çƒŸèŠ±æ•ˆæœå‡½æ•°
        function createFireworks() {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * window.innerWidth + 'px';
                    firework.style.top = Math.random() * window.innerHeight + 'px';
                    firework.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    firework.style.boxShadow = `0 0 20px ${firework.style.background}`;
                    document.body.appendChild(firework);
                    
                    // æ—¥æ–‡ç‰ˆçš„çƒŸèŠ±åŠ¨ç”»
                    firework.animate([
                        { transform: 'scale(0) translateY(0)', opacity: 0 },
                        { transform: 'scale(3) translateY(-100px)', opacity: 1 },
                        { transform: 'scale(0) translateY(-200px)', opacity: 0 }
                    ], {
                        duration: 1000,
                        easing: 'ease-out'
                    }).onfinish = () => firework.remove();
                }, i * 100);
            }
        }
        
        // ä¿æŒåŸæœ‰çš„playWinSoundå‡½æ•°æˆ–ä½¿ç”¨æ—¥æ–‡ç‰ˆçš„æ›´å¼ºçƒˆéŸ³æ•ˆ
        function playWinSound() {
            // æ—¥æ–‡ç‰ˆçš„æ›´å¼ºçƒˆå‹åˆ©éŸ³æ•ˆåºåˆ—
            createTone(523, 0.3); // C
            setTimeout(() => createTone(659, 0.3), 200); // E
            setTimeout(() => createTone(784, 0.3), 400); // G
            setTimeout(() => createTone(1047, 0.5), 600); // High C
            setTimeout(() => createTone(659, 0.2), 1000); // E
            setTimeout(() => createTone(784, 0.2), 1100); // G
            setTimeout(() => createTone(1047, 0.8), 1200); // High C sustained
        }
        
        // åˆå§‹åŒ–3Då ´æ™¯
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 15;
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            document.getElementById('container').appendChild(renderer.domElement);
            
            createSphere();
            createParticles();
            
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const pointLight = new THREE.PointLight(0x64b5f6, 1, 100);
            pointLight.position.set(0, 0, 20);
            scene.add(pointLight);
            
            animate();
        }
        
        function createSphere() {
            const geometry = new THREE.SphereGeometry(5, 32, 32);
            const material = new THREE.MeshPhongMaterial({
                color: 0x2196f3,
                transparent: true,
                opacity: 0.3,
                wireframe: true
            });
            sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
        }
        
        function createParticles() {
            const particleCount = 500; // ä»2000å‡å°‘åˆ°500
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);
            
            // å¤šå½©é¡è‰²é™£åˆ—
            const colorPalette = [
                new THREE.Color(0xff4444), // ç´…è‰²
                new THREE.Color(0x00ffcc), // é’ç¶ è‰²
                new THREE.Color(0xffaa00), // æ©™è‰²
                new THREE.Color(0xbb66ff), // ç´«è‰²
                new THREE.Color(0x44ff44), // ç¶ è‰²
                new THREE.Color(0xff44bb), // ç²‰ç´…è‰²
                new THREE.Color(0x4444ff), // è—è‰²
                new THREE.Color(0xffff44), // é»ƒè‰²
                new THREE.Color(0xff8844), // æ©˜ç´…è‰²
                new THREE.Color(0x44ffff), // é’è‰²
                new THREE.Color(0xcc44ff), // ç´«ç´…è‰²
                new THREE.Color(0x88ff44)  // æª¸æª¬ç¶ 
            ];
            
            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 50;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 50;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 50;
                
                // éš¨æ©Ÿé¸æ“‡é¡è‰²
                const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.15,
                vertexColors: true,
                transparent: true,
                opacity: 0.8
            });
            
            particleSystem = new THREE.Points(geometry, material);
            scene.add(particleSystem);
        }
        
        // ä¿®æ”¹createNameTextså‡½æ•°ä¸­çš„å­—ä½“è®¾ç½®ï¼Œå‚è€ƒä¼˜åŒ–ç‰ˆæœ¬
        function createNameTexts() {
            nameObjects.forEach(obj => scene.remove(obj));
            nameObjects = [];
            
            if (names.length === 0) return;
            
            names.forEach((name, index) => {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                // å‚è€ƒä¼˜åŒ–ç‰ˆæœ¬çš„ç”»å¸ƒå°ºå¯¸
                canvas.width = 256;
                canvas.height = 128;
                
                context.clearRect(0, 0, canvas.width, canvas.height);
                
                // å‚è€ƒä¼˜åŒ–ç‰ˆæœ¬çš„å­—ä½“è®¾ç½®
                context.shadowColor = '#64b5f6';
                context.shadowBlur = 20;
                context.fillStyle = '#ffffff';
                context.font = 'bold 28px -apple-system, BlinkMacSystemFont, sans-serif'; // ä½¿ç”¨28pxå­—ä½“
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.fillText(name, canvas.width / 2, canvas.height / 2);
                
                context.shadowBlur = 0;
                context.strokeStyle = '#64b5f6';
                context.lineWidth = 2;
                context.strokeText(name, canvas.width / 2, canvas.height / 2);
                
                const texture = new THREE.CanvasTexture(canvas);
                const material = new THREE.MeshBasicMaterial({
                    map: texture,
                    transparent: true,
                    side: THREE.DoubleSide
                });
                
                // å‚è€ƒä¼˜åŒ–ç‰ˆæœ¬çš„å‡ ä½•ä½“å°ºå¯¸
                const geometry = new THREE.PlaneGeometry(3, 1.5); // 3x1.5çš„å°ºå¯¸
                const mesh = new THREE.Mesh(geometry, material);
                
                const phi = Math.acos(-1 + (2 * index) / names.length);
                const theta = Math.sqrt(names.length * Math.PI) * phi;
                
                const radius = 7;
                mesh.position.x = radius * Math.cos(theta) * Math.sin(phi);
                mesh.position.y = radius * Math.sin(theta) * Math.sin(phi);
                mesh.position.z = radius * Math.cos(phi);
                
                mesh.lookAt(camera.position);
                mesh.userData = { 
                    name: name, 
                    originalPosition: mesh.position.clone(),
                    phi: phi,
                    theta: theta,
                    radius: radius
                };
                
                scene.add(mesh);
                nameObjects.push(mesh);
            });
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // çƒä½“æ—‹è½¬ï¼ˆä»…åœ¨æŠ½å¥–æ—¶ï¼‰
            if (isSpinning || isSlowingDown) {
                sphere.rotation.x += rotationSpeed;
                sphere.rotation.y += rotationSpeed * 1.2;
                
                if (isSlowingDown) {
                    rotationSpeed *= 0.98;
                    if (rotationSpeed < 0.001) {
                        stopLottery();
                    }
                }
            }
            
            // åå­—å¯¹è±¡ä½ç½®å’Œæœå‘æ›´æ–° - å§‹ç»ˆæ‰§è¡Œï¼Œç¡®ä¿é¢å‘æ‘„åƒæœº
            nameObjects.forEach((obj, index) => {
                if (obj && obj.userData) {
                    const rotationX = sphere.rotation.x || 0;
                    const rotationY = sphere.rotation.y || 0;
                    
                    const phi = obj.userData.phi;
                    const theta = obj.userData.theta + rotationY;
                    const adjustedPhi = phi + rotationX;
                    
                    const radius = obj.userData.radius;
                    obj.position.x = radius * Math.cos(theta) * Math.sin(adjustedPhi);
                    obj.position.y = radius * Math.sin(theta) * Math.sin(adjustedPhi);
                    obj.position.z = radius * Math.cos(adjustedPhi);
                    
                    // å…³é”®ä¿®å¤ï¼šå§‹ç»ˆè®©åå­—é¢å‘æ‘„åƒæœº
                    obj.lookAt(camera.position);
                    
                    // ç¡®ä¿å¯¹è±¡å¯è§æ€§
                    obj.visible = true;
                }
            });
            
            // ç²’å­ç³»ç»ŸåŠ¨ç”» - å§‹ç»ˆè¿è¡Œ
            if (particleSystem) {
                particleSystem.rotation.x += 0.001;
                particleSystem.rotation.y += 0.002;
                
                // æŠ½å¥–æ—¶å¢åŠ é¢å¤–æ—‹è½¬
                if (isSpinning) {
                    particleSystem.rotation.x += rotationSpeed * 0.5;
                    particleSystem.rotation.y += rotationSpeed * 0.7;
                }
            }
            
            // æ‘„åƒæœºåŠ¨ç”» - å§‹ç»ˆè¿è¡Œ
            const time = Date.now() * 0.001;
            camera.position.x = Math.cos(time * 0.1) * 15;
            camera.position.y = Math.sin(time * 0.1) * 5;
            camera.lookAt(0, 0, 0);
            
            // å§‹ç»ˆæ¸²æŸ“åœºæ™¯
            renderer.render(scene, camera);
        }
        
        function startLottery() {
            if (names.length === 0) return;
            const t = translations[currentLang];
            
            isSpinning = true;
            isSlowingDown = false;
            rotationSpeed = 0.3;
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('status').textContent = t.drawing;
            document.getElementById('winner').style.display = 'none';
            
            playSpinSound();
        }
        
        function slowDown() {
            if (!isSpinning) return;
            const t = translations[currentLang];
            
            isSlowingDown = true;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('status').textContent = t.slowing;
        }
        
        // ä¿®å¤stopLotteryå‡½æ•° - ä½¿ç”¨æè´¨å…‹éš†è€Œä¸æ˜¯ä¿®æ”¹emissive
        function stopLottery() {
            isSpinning = false;
            isSlowingDown = false;
            rotationSpeed = 0;
            const t = translations[currentLang];
            
            const winner = names[Math.floor(Math.random() * names.length)];
            
            // æ·»åŠ åˆ°æ­·å²è¨˜éŒ„
            addToHistory(winner, currentPrize);
            
            const winnerDiv = document.getElementById('winner');
            const winnerNameDiv = document.getElementById('winnerName');
            const prizeTextDiv = document.getElementById('prizeText');
            
            winnerNameDiv.textContent = winner;
            prizeTextDiv.textContent = `${t.prizeLabel}${currentPrize}`;
            winnerDiv.style.display = 'block';
            
            // é‡æ–°è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ä»¥ç¡®ä¿å…³é—­æŒ‰é’®å·¥ä½œ
            setupWinnerModalEvents();
            
            createFireworks();
            createConfetti();
            createCheerSound();
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('status').textContent = `${t.winnerStatus} ${winner} | ${t.received} ${currentPrize}`;
            
            playWinSound();
            
            // é«˜äº®è·å¥–è€…
            nameObjects.forEach(obj => {
                if (obj && obj.userData && obj.material) {
                    if (obj.userData.name === winner) {
                        const originalMaterial = obj.material;
                        const highlightMaterial = originalMaterial.clone();
                        highlightMaterial.color = new THREE.Color(0x00ff88);
                        obj.material = highlightMaterial;
                        obj.userData.originalMaterial = originalMaterial;
                        obj.userData.isWinner = true;
                    } else {
                        obj.userData.isWinner = false;
                    }
                    obj.visible = true;
                }
            });
            
            // 8ç§’åæ¢å¤
            setTimeout(() => {
                winnerDiv.style.display = 'none';
                nameObjects.forEach(obj => {
                    if (obj && obj.userData && obj.userData.isWinner && obj.userData.originalMaterial) {
                        obj.material = obj.userData.originalMaterial;
                        obj.userData.isWinner = false;
                    }
                });
            }, 8000);
        }
        
        function loadNames() {
            const input = document.getElementById('nameInput').value.trim();
            const prizeInput = document.getElementById('prizeInput').value.trim();
            const t = translations[currentLang];
            
            if (!input) {
                alert(t.alertLoadNames);
                return;
            }
            
            names = input.split('\n').filter(name => name.trim()).map(name => name.trim());
            
            if (names.length === 0) {
                alert(t.alertValidNames);
                return;
            }
            
            currentPrize = prizeInput || t.defaultPrize;
            
            createNameTexts();
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('status').textContent = `${names.length} ${t.loadedStatus} ${currentPrize}`;
        }
        
        function addToHistory(winner, prize) {
            const now = new Date();
            const timeString = now.toLocaleString(currentLang === 'zh' ? 'zh-CN' : currentLang === 'ja' ? 'ja-JP' : 'en-US');
            
            winHistory.unshift({
                time: timeString,
                winner: winner,
                prize: prize,
                timestamp: now.getTime()
            });
            
            // åªä¿ç•™æœ€æ–°çš„50æ¢è¨˜éŒ„
            if (winHistory.length > 50) {
                winHistory = winHistory.slice(0, 50);
            }
        }
        
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            const t = translations[currentLang];
            
            if (winHistory.length === 0) {
                historyList.innerHTML = `<div style="text-align: center; opacity: 0.7; padding: 20px;">${t.status}</div>`;
                return;
            }
            
            historyList.innerHTML = winHistory.map(record => `
                <div class="history-item">
                    <div class="history-time">${record.time}</div>
                    <div class="history-winner">${record.winner}</div>
                    <div class="history-prize">${t.prizeLabel}${record.prize}</div>
                </div>
            `).join('');
        }
        
        // äº‹ä»¶ç›£è½å™¨
        document.getElementById('collapseLink').addEventListener('click', () => {
            const controls = document.getElementById('controls');
            const collapseLink = document.getElementById('collapseLink');
            const t = translations[currentLang];
            
            controls.classList.toggle('collapsed');
            
            if (controls.classList.contains('collapsed')) {
                collapseLink.textContent = '';
            } else {
                collapseLink.textContent = t.collapseLink || 'æ”¶èµ·';
            }
        });
        

        
        // è¯­è¨€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('langBtn').addEventListener('click', switchLanguage);
        
        document.getElementById('loadNamesBtn').addEventListener('click', loadNames);
        document.getElementById('startBtn').addEventListener('click', startLottery);
        document.getElementById('stopBtn').addEventListener('click', slowDown);
        
        // æ­·å²è¨˜éŒ„
        document.getElementById('historyBtn').addEventListener('click', () => {
            renderHistory();
            document.getElementById('historyModal').style.display = 'flex';
        });
        
        document.getElementById('closeHistoryBtn').addEventListener('click', () => {
            document.getElementById('historyModal').style.display = 'none';
        });
        
        document.getElementById('clearHistoryBtn').addEventListener('click', () => {
            const t = translations[currentLang];
            if (confirm(t.confirmClear)) {
                winHistory = [];
                renderHistory();
            }
        });
        
        document.getElementById('historyModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('historyModal')) {
                document.getElementById('historyModal').style.display = 'none';
            }
        });
        
        document.getElementById('winner').addEventListener('click', (e) => {
            if (e.target === document.getElementById('winner')) {
                document.getElementById('winner').style.display = 'none';
            }
        });
        
        document.getElementById('closeBtn').addEventListener('click', () => {
            document.getElementById('winner').style.display = 'none';
        });
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // åˆå§‹åŒ–
        init();
        
        // é»˜èªä½¿ç”¨è‹±è¯­ï¼ˆä»ä¸­æ–‡æ”¹ä¸ºè‹±è¯­ï¼‰
        updateLanguage('en');
        
        // æ·»åŠ è°ƒè¯•å‡½æ•°æ¥æ£€æŸ¥åœºæ™¯çŠ¶æ€
        function debugScene() {
            console.log('Scene children:', scene.children.length);
            console.log('Name objects:', nameObjects.length);
            console.log('Names array:', names);
            nameObjects.forEach((obj, index) => {
                console.log(`Name ${index}:`, obj.userData.name, 'visible:', obj.visible, 'position:', obj.position);
            });
        }
        
        // åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­å¯ä»¥è°ƒç”¨ debugScene() æ¥æ£€æŸ¥çŠ¶æ€
        window.debugScene = debugScene;

        // åœ¨äº‹ä»¶ç›‘å¬å™¨éƒ¨åˆ†æ·»åŠ é‚®ä»¶ç‚¹å‡»åŠŸèƒ½
        // åº•éƒ¨ç½²åé‚®ä»¶å‘é€åŠŸèƒ½ï¼ˆä½¿ç”¨é»˜è®¤é‚®ä»¶å®¢æˆ·ç«¯ï¼‰
        document.getElementById('footerText').addEventListener('click', (e) => {
            e.preventDefault();
            // ä¿®æ”¹ä¸ºè‹±æ–‡é‚®ä»¶å†…å®¹
            const subject = encodeURIComponent('About 3D Lottery System');
            const body = encodeURIComponent('Hello,\n\nI would like to contact you regarding the 3D Lottery System.\n\nThank you!');
            window.location.href = `mailto:hihi.todd@gmail.com?subject=${subject}&body=${body}`;
        });

        // ä¿®å¤äº‹ä»¶ç›‘å¬å™¨ - ç¡®ä¿å…³é—­æŒ‰é’®æ­£ç¡®å·¥ä½œ
        function setupWinnerModalEvents() {
            const closeBtn = document.getElementById('closeBtn');
            const winnerDiv = document.getElementById('winner');
            const winnerContent = document.getElementById('winnerContent');
            
            // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (closeBtn) {
                closeBtn.replaceWith(closeBtn.cloneNode(true));
            }
            
            // é‡æ–°è·å–å…ƒç´ å¹¶ç»‘å®šäº‹ä»¶
            const newCloseBtn = document.getElementById('closeBtn');
            const newWinnerDiv = document.getElementById('winner');
            const newWinnerContent = document.getElementById('winnerContent');
            
            // å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            if (newCloseBtn) {
                newCloseBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Close button clicked successfully');
                    newWinnerDiv.style.display = 'none';
                }, { passive: false });
                
                // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
                newCloseBtn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Close button touched');
                    newWinnerDiv.style.display = 'none';
                }, { passive: false });
            }
            
            // èƒŒæ™¯ç‚¹å‡»å…³é—­
            if (newWinnerDiv) {
                newWinnerDiv.addEventListener('click', function(e) {
                    if (e.target === newWinnerDiv) {
                        console.log('Winner background clicked');
                        newWinnerDiv.style.display = 'none';
                    }
                });
            }
            
            // é˜²æ­¢å†…å®¹åŒºåŸŸç‚¹å‡»å†’æ³¡
            if (newWinnerContent) {
                newWinnerContent.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            // é”®ç›˜ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && newWinnerDiv.style.display === 'block') {
                    newWinnerDiv.style.display = 'none';
                }
            });
        }

        // åœ¨é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', setupWinnerModalEvents);
    </script>
</body>
</html>